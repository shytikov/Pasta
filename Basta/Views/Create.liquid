{% extends "Layout.liquid" %}

{% block title %}Cook new!{% endblock %}

{% block header %}
     <script type="text/javascript" src="/content/js/vendor/jquery-1.8.2.min.js"></script>
{% endblock %}

{% block content %}
    <form action="/Create" method="post">
        <fieldset>
        <div id="Content" contenteditable="true"></div>
        <p><input type="submit" value="Store" /></p>
        </fieldset>
    </form>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $("div.main form input:submit").click(function (event) {
                var content = $("div.main form #Content").html();

                if (content == "") {
                    return false;
                }

                event.preventDefault();

                var id;

                $.post(
                    "/Create",
                    { "Content": content },
                    function (pastie) {
                        id = pastie.Id;
                        $("div.main h1").text("#" + pastie.Id + "");
                    },
                    "json"
                )

                var main = $("div.main");

                main.slideUp(function () {
                    $("div.main form").remove();
                    if (undefined == id) {
                        main.prepend("<h1>#</h1>");
                    } else {
                        main.prepend("<h1>#" + id + "</h1>");
                    }

                    main.append("<pre><code class='prettyprint linenums'>" + $('<div/>').text(content).html() + "</code></pre>");
                    main.slideDown();

                    $.getScript(
                        "/content/js/vendor/prettify.js",
                        function () {
                            prettyPrint();
                        });
                });

            })
        });	
    </script>
{% endblock %}